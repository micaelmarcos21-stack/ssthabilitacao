<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Controle de Habilita√ß√£o - Obra</title>
  <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
  // ====== CONFIGURA√á√ÉO DA SENHA - ALTERE AQUI! ======
  const SENHA_ADMIN = "terralsst123"; // ‚Üê MUDE ESTA SENHA!

  // ====== CONFIGURA√á√ÉO DO FIREBASE (j√° preenchida) ======
  const firebaseConfig = {
    apiKey: "AIzaSyC3TaHDdufIXYTVmUfTFuxlf8hQtn39kEE",
    authDomain: "hbfisc.firebaseapp.com",
    projectId: "hbfisc",
    storageBucket: "hbfisc.firebasestorage.app",
    messagingSenderId: "1030363399489",
    appId: "1:1030363399489:web:a45fc8923b41e68fac8dc0"
  };

  // Inicializa Firebase (compat) e Firestore
  let db = null;
  let firebaseEnabled = false;
  try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
    firebaseEnabled = true;
    console.log("Firebase inicializado, projectId:", firebaseConfig.projectId);
  } catch (err) {
    console.error("Erro ao inicializar Firebase:", err);
    firebaseEnabled = false;
  }

  function App() {
    const [motoristas, setMotoristas] = React.useState([]);
    const [mostrarFormulario, setMostrarFormulario] = React.useState(false);
    const [editandoId, setEditandoId] = React.useState(null);
    const [filtro, setFiltro] = React.useState('todos');
    const [abaAtiva, setAbaAtiva] = React.useState('dados');
    const [mostrarRelatorio, setMostrarRelatorio] = React.useState(false);
    const [autenticado, setAutenticado] = React.useState(false);
    const [senhaInput, setSenhaInput] = React.useState('');
    const [mostrarModalSenha, setMostrarModalSenha] = React.useState(false);
    const [acaoPendente, setAcaoPendente] = React.useState(null);

    const [formulario, setFormulario] = React.useState({
      nome: '',
      cnh: '',
      dataEmissao: '',
      dataVencimento: '',
      categoria: 'B',
      observacoes: '',
      fotoUrl: '',
      cursos: {
        retroescavadeira: { possui: false, validade: '', numero: '' },
        caminhaoMunk: { possui: false, validade: '', numero: '' },
        empilhadeira: { possui: false, validade: '', numero: '' },
        plataformaElevada: { possui: false, validade: '', numero: '' },
        guindasteMovel: { possui: false, validade: '', numero: '' },
        escavadeiraHidraulica: { possui: false, validade: '', numero: '' },
        paCarregadeira: { possui: false, validade: '', numero: '' },
        motoniveladora: { possui: false, validade: '', numero: '' },
        rolo: { possui: false, validade: '', numero: '' },
        nr11: { possui: false, validade: '', numero: '' },
        nr12: { possui: false, validade: '', numero: '' },
        nr18: { possui: false, validade: '', numero: '' },
        nr35: { possui: false, validade: '', numero: '' },
        direcaoDefensiva: { possui: false, validade: '', numero: '' },
        primeirosocorros: { possui: false, validade: '', numero: '' },
        mopp: { possui: false, validade: '', numero: '' }
      }
    });

    const listaCursos = {
      retroescavadeira: 'Operador de Retroescavadeira',
      caminhaoMunk: 'Operador de Caminh√£o Munck',
      empilhadeira: 'Operador de Empilhadeira',
      plataformaElevada: 'Operador de Plataforma Elevat√≥ria',
      guindasteMovel: 'Operador de Guindaste M√≥vel',
      escavadeiraHidraulica: 'Operador de Escavadeira Hidr√°ulica',
      paCarregadeira: 'Operador de P√° Carregadeira',
      motoniveladora: 'Operador de Motoniveladora',
      rolo: 'Operador de Rolo Compactador',
      nr11: 'NR-11 (Transporte de Cargas)',
      nr12: 'NR-12 (Seguran√ßa em M√°quinas)',
      nr18: 'NR-18 (Constru√ß√£o Civil)',
      nr35: 'NR-35 (Trabalho em Altura)',
      direcaoDefensiva: 'Dire√ß√£o Defensiva',
      primeirosocorros: 'Primeiros Socorros',
      mopp: 'MOPP (Produtos Perigosos)'
    };

    React.useEffect(() => {
      localStorage.setItem('motoristas', JSON.stringify(motoristas));
    }, [motoristas]);

    React.useEffect(() => {
      if (!firebaseEnabled) {
        const salvos = localStorage.getItem('motoristas');
        if (salvos) {
          try { setMotoristas(JSON.parse(salvos)); } catch(e){ console.error(e); }
        }
        return;
      }

      const unsubscribe = db.collection('motoristas').orderBy('nome').onSnapshot((snapshot) => {
        const docs = snapshot.docs.map(doc => doc.data());
        setMotoristas(docs);
      }, (err) => {
        console.error('Erro ao ler motoristas no Firestore:', err);
      });

      return () => unsubscribe();
    }, []);

    const calcularDiasParaVencer = (dataVencimento) => {
      if (!dataVencimento) return 999;
      const hoje = new Date();
      const vencimento = new Date(dataVencimento);
      const diffTime = vencimento - hoje;
      return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    };

    const getStatusVencimento = (dataVencimento) => {
      const dias = calcularDiasParaVencer(dataVencimento);
      if (dias < 0) return { status: 'vencida', cor: 'bg-red-100 border-red-500', texto: 'VENCIDA', icone: 'üî¥' };
      else if (dias <= 30) return { status: 'vence-breve', cor: 'bg-yellow-100 border-yellow-500', texto: `Vence em ${dias} dias`, icone: '‚ö†Ô∏è' };
      else if (dias <= 60) return { status: 'atencao', cor: 'bg-orange-100 border-orange-500', texto: `Vence em ${dias} dias`, icone: 'üü†' };
      else return { status: 'regular', cor: 'bg-green-100 border-green-500', texto: 'Regular', icone: '‚úÖ' };
    };

    const salvarMotoristaFirestore = async (motorista) => {
      if (!firebaseEnabled) {
        if (motorista.id == null) motorista.id = Date.now();
        const novo = [...motoristas.filter(m => m.id !== motorista.id), motorista];
        setMotoristas(novo);
        return;
      }
      const idStr = String(motorista.id ?? Date.now());
      motorista.id = Number(idStr);
      await db.collection('motoristas').doc(idStr).set(motorista);
    };

    const excluirMotoristaFirestore = async (id) => {
      if (!firebaseEnabled) {
        setMotoristas(motoristas.filter(m => m.id !== id));
        return;
      }
      await db.collection('motoristas').doc(String(id)).delete();
    };

    const migrarLocalParaFirestore = async () => {
      if (!firebaseEnabled) {
        alert('Firebase n√£o configurado. Cole as credenciais no arquivo.');
        return;
      }
      const salvos = localStorage.getItem('motoristas');
      if (!salvos) {
        alert('Nenhum dado local encontrado para migrar.');
        return;
      }
      let dados = [];
      try { dados = JSON.parse(salvos); } catch(e) { alert('Arquivo local inv√°lido.'); return; }
      if (!confirm(`Migrar ${dados.length} motoristas do localStorage para o Firestore? Isso adicionar√° os registros ao banco na nuvem.`)) return;
      const batch = db.batch ? db.batch() : null;
      try {
        for (const m of dados) {
          const idStr = String(m.id ?? Date.now() + Math.floor(Math.random() * 1000));
          if (batch) {
            const ref = db.collection('motoristas').doc(idStr);
            batch.set(ref, { ...m, id: Number(idStr) });
          } else {
            await db.collection('motoristas').doc(idStr).set({ ...m, id: Number(idStr) });
          }
        }
        if (batch) await batch.commit();
        alert('Migra√ß√£o conclu√≠da. Os dados j√° est√£o no Firestore e ser√£o exibidos em tempo real.');
      } catch (err) {
        console.error(err);
        alert('Erro durante migra√ß√£o. Veja o console para detalhes.');
      }
    };

    const exportarDados = () => {
      const dataStr = JSON.stringify(motoristas, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `controle-habilitacao-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
    };

    const importarDados = (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const dados = JSON.parse(e.target.result);
            if (confirm(`Importar ${dados.length} motoristas? Isso substituir√° os dados locais (n√£o afeta o Firestore automaticamente).`)) {
              setMotoristas(dados);
              alert('Dados importados localmente com sucesso! Se quiser envi√°-los para a nuvem, use "Migrar local para Firestore".');
            }
          } catch (error) {
            alert('Erro ao importar arquivo. Verifique se √© um arquivo JSON v√°lido.');
          }
        };
        reader.readAsText(file);
      }
    };

    const gerarLinkCompartilhamento = () => {
      const dataStr = JSON.stringify(motoristas);
      const encoded = btoa(encodeURIComponent(dataStr));
      const url = window.location.href.split('?')[0] + '?dados=' + encoded;
      navigator.clipboard.writeText(url).then(() => {
        alert('Link copiado! Cole e envie para outras pessoas acessarem os dados (visualiza√ß√£o).');
      }).catch(() => {
        prompt('Copie este link:', url);
      });
    };

    const imprimirRelatorio = () => {
      setMostrarRelatorio(true);
      setTimeout(() => {
        window.print();
      }, 100);
    };

    React.useEffect(() => {
      const urlParams = new URLSearchParams(window.location.search);
      const dadosParam = urlParams.get('dados');
      if (dadosParam) {
        try {
          const decoded = JSON.parse(decodeURIComponent(atob(dadosParam)));
          if (confirm(`Carregar ${decoded.length} motoristas do link compartilhado?`)) {
            setMotoristas(decoded);
          }
        } catch (error) {
          console.error('Erro ao carregar dados do link', error);
        }
      }
    }, []);

    const handleSubmit = async (e) => {
      e.preventDefault();
      if (editandoId !== null) {
        const atualizado = { ...formulario, id: editandoId };
        await salvarMotoristaFirestore(atualizado);
        setEditandoId(null);
      } else {
        const novoMotorista = { ...formulario, id: Date.now() };
        await salvarMotoristaFirestore(novoMotorista);
      }
      setFormulario({
        nome: '',
        cnh: '',
        dataEmissao: '',
        dataVencimento: '',
        categoria: 'B',
        observacoes: '',
        fotoUrl: '',
        cursos: {
          retroescavadeira: { possui: false, validade: '', numero: '' },
          caminhaoMunk: { possui: false, validade: '', numero: '' },
          empilhadeira: { possui: false, validade: '', numero: '' },
          plataformaElevada: { possui: false, validade: '', numero: '' },
          guindasteMovel: { possui: false, validade: '', numero: '' },
          escavadeiraHidraulica: { possui: false, validade: '', numero: '' },
          paCarregadeira: { possui: false, validade: '', numero: '' },
          motoniveladora: { possui: false, validade: '', numero: '' },
          rolo: { possui: false, validade: '', numero: '' },
          nr11: { possui: false, validade: '', numero: '' },
          nr12: { possui: false, validade: '', numero: '' },
          nr18: { possui: false, validade: '', numero: '' },
          nr35: { possui: false, validade: '', numero: '' },
          direcaoDefensiva: { possui: false, validade: '', numero: '' },
          primeirosocorros: { possui: false, validade: '', numero: '' },
          mopp: { possui: false, validade: '', numero: '' }
        }
      });
      setMostrarFormulario(false);
      setAbaAtiva('dados');
    };

    const verificarSenha = (acao) => {
      setAcaoPendente(() => acao);
      setMostrarModalSenha(true);
      setSenhaInput('');
    };

    const confirmarSenha = () => {
      if (senhaInput === SENHA_ADMIN) {
        setAutenticado(true);
        setMostrarModalSenha(false);
        if (acaoPendente) {
          acaoPendente();
          setAcaoPendente(null);
        }
      } else {
        alert('‚ùå Senha incorreta! Apenas administradores podem fazer altera√ß√µes.');
        setSenhaInput('');
      }
    };

    const handleEditar = (motorista) => {
      if (!autenticado) {
        verificarSenha(() => {
          setFormulario(motorista);
          setEditandoId(motorista.id);
          setMostrarFormulario(true);
          setAbaAtiva('dados');
        });
      } else {
        setFormulario(motorista);
        setEditandoId(motorista.id);
        setMostrarFormulario(true);
        setAbaAtiva('dados');
      }
    };

    const handleExcluir = (id) => {
      if (!autenticado) {
        verificarSenha(async () => {
          if (confirm('Deseja realmente excluir este motorista?')) {
            await excluirMotoristaFirestore(id);
          }
        });
      } else {
        if (confirm('Deseja realmente excluir este motorista?')) {
          excluirMotoristaFirestore(id);
        }
      }
    };

    const handleNovoMotorista = () => {
      if (!autenticado) {
        verificarSenha(() => {
          setMostrarFormulario(true);
          setEditandoId(null);
          setAbaAtiva('dados');
        });
      } else {
        setMostrarFormulario(true);
        setEditandoId(null);
        setAbaAtiva('dados');
      }
    };

    const motoristasFiltrados = motoristas.filter(m => {
      if (filtro === 'todos') return true;
      const status = getStatusVencimento(m.dataVencimento).status;
      return status === filtro;
    });

    const contadores = {
      vencidas: motoristas.filter(m => getStatusVencimento(m.dataVencimento).status === 'vencida').length,
      venceBreve: motoristas.filter(m => getStatusVencimento(m.dataVencimento).status === 'vence-breve').length,
      atencao: motoristas.filter(m => getStatusVencimento(m.dataVencimento).status === 'atencao').length,
      regular: motoristas.filter(m => getStatusVencimento(m.dataVencimento).status === 'regular').length
    };

    const getCursosAtivos = (cursos) => {
      return Object.entries(cursos || {}).filter(([key, value]) => value.possui);
    };

    if (mostrarModalSenha) {
      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 className="text-2xl font-bold text-gray-800 mb-4">üîí Acesso Restrito</h2>
            <p className="text-gray-600 mb-6">Digite a senha de administrador para fazer altera√ß√µes:</p>
            <input
              type="password"
              value={senhaInput}
              onChange={(e) => setSenhaInput(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && confirmarSenha()}
              className="w-full border-2 border-gray-300 rounded-lg px-4 py-3 mb-4 text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Digite a senha"
              autoFocus
            />
            <div className="flex gap-3">
              <button onClick={confirmarSenha} className="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-semibold">‚úì Confirmar</button>
              <button onClick={() => { setMostrarModalSenha(false); setSenhaInput(''); setAcaoPendente(null); }} className="flex-1 bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 font-semibold">‚úï Cancelar</button>
            </div>
            <p className="text-xs text-gray-500 mt-4 text-center">üí° Apenas administradores podem adicionar, editar ou excluir registros</p>
          </div>
        </div>
      );
    }

    if (mostrarRelatorio) {
      return (
        <div className="bg-white p-8">
          <style>{`@media print { body { margin: 0; padding: 20px; } .no-print { display: none !important; } .page-break { page-break-after: always; } }`}</style>
          <div className="no-print mb-4 text-center">
            <button onClick={() => setMostrarRelatorio(false)} className="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 font-semibold mr-2">‚Üê Voltar</button>
            <button onClick={imprimirRelatorio} className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-semibold">üñ®Ô∏è Imprimir</button>
          </div>
          <div className="text-center mb-6 border-b-2 border-gray-800 pb-4">
            <h1 className="text-3xl font-bold text-gray-900">RELAT√ìRIO DE CONTROLE DE HABILITA√á√ÉO</h1>
            <p className="text-gray-600 mt-2">Gest√£o de CNH e Certifica√ß√µes - Obra</p>
            <p className="text-sm text-gray-500 mt-1">Gerado em: {new Date().toLocaleDateString('pt-BR')} √†s {new Date().toLocaleTimeString('pt-BR')}</p>
          </div>

          <div className="mb-6 border border-gray-300 rounded p-4">
            <h2 className="text-xl font-bold mb-3">üìä RESUMO GERAL</h2>
            <div className="grid grid-cols-4 gap-4">
              <div className="text-center p-3 bg-red-50 border border-red-500 rounded">
                <div className="text-2xl font-bold text-red-700">{contadores.vencidas}</div>
                <div className="text-sm text-red-600">CNHs Vencidas</div>
              </div>
              <div className="text-center p-3 bg-yellow-50 border border-yellow-500 rounded">
                <div className="text-2xl font-bold text-yellow-700">{contadores.venceBreve}</div>
                <div className="text-sm text-yellow-600">Vencem em 30 dias</div>
              </div>
              <div className="text-center p-3 bg-orange-50 border border-orange-500 rounded">
                <div className="text-2xl font-bold text-orange-700">{contadores.atencao}</div>
                <div className="text-sm text-orange-600">Aten√ß√£o (60 dias)</div>
              </div>
              <div className="text-center p-3 bg-green-50 border border-green-500 rounded">
                <div className="text-2xl font-bold text-green-700">{contadores.regular}</div>
                <div className="text-sm text-green-600">Regulares</div>
              </div>
            </div>
            <div className="mt-3 text-center"><span className="text-lg font-bold">Total de Motoristas: {motoristas.length}</span></div>
          </div>

          {motoristas.map((motorista, index) => {
            const statusInfo = getStatusVencimento(motorista.dataVencimento);
            const cursosAtivos = getCursosAtivos(motorista.cursos);
            return (
              <div key={motorista.id} className={`mb-6 border-2 rounded p-4 ${index > 0 && index % 2 === 0 ? 'page-break' : ''}`} style={{borderColor: statusInfo.status === 'vencida' ? '#ef4444' : statusInfo.status === 'vence-breve' ? '#eab308' : statusInfo.status === 'atencao' ? '#f97316' : '#22c55e'}}>
                <div className="flex justify-between items-start mb-3 border-b pb-2">
                  <div>
                    <h3 className="text-xl font-bold">{motorista.nome}</h3>
                    <p className="text-sm text-gray-600">CNH: {motorista.cnh} | Categoria: {motorista.categoria}</p>
                  </div>
                  <div className="text-right">
                    <div className="font-bold text-lg" style={{color: statusInfo.status === 'vencida' ? '#dc2626' : statusInfo.status === 'vence-breve' ? '#ca8a04' : statusInfo.status === 'atencao' ? '#ea580c' : '#16a34a'}}>
                      {statusInfo.texto}
                    </div>
                  </div>
                </div>

                <div className="grid grid-cols-3 gap-4 mb-3">
                  <div><span className="text-sm font-bold">Data de Emiss√£o:</span><p>{motorista.dataEmissao ? new Date(motorista.dataEmissao + 'T00:00:00').toLocaleDateString('pt-BR') : '-'}</p></div>
                  <div><span className="text-sm font-bold">Data de Vencimento:</span><p>{motorista.dataVencimento ? new Date(motorista.dataVencimento + 'T00:00:00').toLocaleDateString('pt-BR') : '-'}</p></div>
                  <div><span className="text-sm font-bold">Dias para Vencer:</span><p>{motorista.dataVencimento ? calcularDiasParaVencer(motorista.dataVencimento) : '-'} dias</p></div>
                </div>

                {cursosAtivos.length > 0 && (
                  <div className="mt-3 border-t pt-3">
                    <h4 className="font-bold mb-2">CURSOS E CERTIFICA√á√ïES:</h4>
                    <table className="w-full text-sm border-collapse">
                      <thead><tr className="bg-gray-100"><th className="border border-gray-300 p-2 text-left">Curso</th><th className="border border-gray-300 p-2 text-left">N¬∫ Certificado</th><th className="border border-gray-300 p-2 text-left">Validade</th><th className="border border-gray-300 p-2 text-left">Status</th></tr></thead>
                      <tbody>
                        {cursosAtivos.map(([key, value]) => {
                          const statusCurso = value.validade ? getStatusVencimento(value.validade) : null;
                          return (
                            <tr key={key}>
                              <td className="border border-gray-300 p-2">{listaCursos[key]}</td>
                              <td className="border border-gray-300 p-2">{value.numero || '-'}</td>
                              <td className="border border-gray-300 p-2">{value.validade ? new Date(value.validade + 'T00:00:00').toLocaleDateString('pt-BR') : 'N√£o informada'}</td>
                              <td className="border border-gray-300 p-2 font-bold" style={{color: statusCurso ? (statusCurso.status === 'vencida' ? '#dc2626' : statusCurso.status === 'vence-breve' ? '#ca8a04' : statusCurso.status === 'atencao' ? '#ea580c' : '#16a34a') : '#000'}}>{statusCurso ? statusCurso.texto : 'N/A'}</td>
                            </tr>
                          );
                        })}
                      </tbody>
                    </table>
                  </div>
                )}

                {motorista.observacoes && (
                  <div className="mt-3 border-t pt-2"><span className="text-sm font-bold">Observa√ß√µes:</span><p className="text-sm">{motorista.observacoes}</p></div>
                )}
              </div>
            );
          })}

          <div className="mt-8 text-center text-sm text-gray-500 border-t pt-4">
            <p>Relat√≥rio gerado automaticamente pelo Sistema de Controle de Habilita√ß√£o</p>
            <p>Este documento cont√©m informa√ß√µes confidenciais da obra</p>
          </div>
        </div>
      );
    }

    return (
      <div className="min-h-screen bg-gray-50 p-4">
        <div className="max-w-7xl mx-auto">
          <div className="bg-white rounded-lg shadow-md p-6 mb-6">
            <div className="flex justify-between items-center mb-4">
              <div>
                <h1 className="text-3xl font-bold text-gray-800">üöó Controle de Habilita√ß√£o - Obra</h1>
                <p className="text-gray-600">Gest√£o completa de CNH, cursos e certifica√ß√µes</p>
                {autenticado && (<p className="text-green-600 text-sm mt-1">üîì Modo Administrador Ativo</p>)}
                {firebaseEnabled ? <p className="text-blue-600 text-sm mt-1">üåê Salvando na nuvem (Firestore)</p> : <p className="text-orange-600 text-sm mt-1">‚ö†Ô∏è Firebase n√£o configurado - usando apenas localStorage</p>}
              </div>
              <div className="flex gap-2">
                <button onClick={() => { setMostrarRelatorio(true); setTimeout(()=>window.print(),100); }} className="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 font-semibold text-sm">üìÑ Gerar Relat√≥rio</button>
                <button onClick={exportarDados} className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 font-semibold text-sm">üíæ Exportar</button>
                <label className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 font-semibold text-sm cursor-pointer">
                  üìÇ Importar
                  <input type="file" accept=".json" onChange={importarDados} className="hidden" />
                </label>
                <button onClick={gerarLinkCompartilhamento} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-semibold text-sm">üîó Compartilhar</button>
                <button onClick={handleNovoMotorista} className="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 font-semibold">{mostrarFormulario ? '‚úï Cancelar' : '+ Novo Motorista'}</button>
              </div>
            </div>

            <div className="grid grid-cols-4 gap-4 mt-6">
              <div className="bg-red-50 border-2 border-red-500 rounded-lg p-4 cursor-pointer hover:shadow-lg transition" onClick={() => setFiltro('vencida')}>
                <div className="text-red-700 text-2xl font-bold">{contadores.vencidas}</div>
                <div className="text-red-600 text-sm">üî¥ Vencidas</div>
              </div>
              <div className="bg-yellow-50 border-2 border-yellow-500 rounded-lg p-4 cursor-pointer hover:shadow-lg transition" onClick={() => setFiltro('vence-breve')}>
                <div className="text-yellow-700 text-2xl font-bold">{contadores.venceBreve}</div>
                <div className="text-yellow-600 text-sm">‚ö†Ô∏è Vencem em 30 dias</div>
              </div>
              <div className="bg-orange-50 border-2 border-orange-500 rounded-lg p-4 cursor-pointer hover:shadow-lg transition" onClick={() => setFiltro('atencao')}>
                <div className="text-orange-700 text-2xl font-bold">{contadores.atencao}</div>
                <div className="text-orange-600 text-sm">üü† Aten√ß√£o (60 dias)</div>
              </div>
              <div className="bg-green-50 border-2 border-green-500 rounded-lg p-4 cursor-pointer hover:shadow-lg transition" onClick={() => setFiltro('regular')}>
                <div className="text-green-700 text-2xl font-bold">{contadores.regular}</div>
                <div className="text-green-600 text-sm">‚úÖ Regulares</div>
              </div>
            </div>

            {filtro !== 'todos' && (
              <button onClick={() => setFiltro('todos')} className="mt-4 text-blue-600 hover:text-blue-800 text-sm font-semibold">‚Üê Mostrar todos</button>
            )}
          </div>

          {firebaseEnabled && (
            <div className="mb-4">
              <button onClick={migrarLocalParaFirestore} className="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 font-semibold text-sm">‚¨ÜÔ∏è Migrar dados locais para Firestore</button>
            </div>
          )}

          {mostrarFormulario && (
            <div className="bg-white rounded-lg shadow-md p-6 mb-6">
              <h2 className="text-xl font-bold mb-4 text-gray-800">{editandoId ? '‚úèÔ∏è Editar Motorista' : '‚ûï Novo Motorista'}</h2>

              <div className="flex border-b mb-6">
                <button onClick={() => setAbaAtiva('dados')} className={`px-6 py-3 font-semibold ${abaAtiva === 'dados' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}>üìã Dados Pessoais e CNH</button>
                <button onClick={() => setAbaAtiva('cursos')} className={`px-6 py-3 font-semibold ${abaAtiva === 'cursos' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}>üéì Cursos e Certifica√ß√µes</button>
              </div>

              <form onSubmit={handleSubmit}>
                {abaAtiva === 'dados' && (
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-1">Nome Completo *</label>
                      <input type="text" required value={formulario.nome} onChange={(e) => setFormulario({...formulario, nome: e.target.value})} className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Nome do motorista" />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-1">N√∫mero da CNH *</label>
                      <input type="text" required value={formulario.cnh} onChange={(e) => setFormulario({...formulario, cnh: e.target.value})} className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0000" />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-1">Data de Emiss√£o *</label>
                      <input type="date" required value={formulario.dataEmissao} onChange={(e) => setFormulario({...formulario, dataEmissao: e.target.value})} className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-1">Data de Vencimento *</label>
                      <input type="date" required value={formulario.dataVencimento} onChange={(e) => setFormulario({...formulario, dataVencimento: e.target.value})} className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-1">Categoria *</label>
                      <select value={formulario.categoria} onChange={(e) => setFormulario({...formulario, categoria: e.target.value})} className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="A">A - Motos</option>
                        <option value="B">B - Carros</option>
                        <option value="AB">AB - Motos e Carros</option>
                        <option value="C">C - Caminh√µes</option>
                        <option value="D">D - √înibus</option>
                        <option value="E">E - Carretas</option>
                      </select>
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-1">URL da Foto/Documento</label>
                      <input type="text" value={formulario.fotoUrl} onChange={(e) => setFormulario({...formulario, fotoUrl: e.target.value})} className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="https://exemplo.com/foto.jpg" />
                    </div>

                    <div className="col-span-2">
                      <label className="block text-sm font-semibold text-gray-700 mb-1">Observa√ß√µes</label>
                      <textarea value={formulario.observacoes} onChange={(e) => setFormulario({...formulario, observacoes: e.target.value})} className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Informa√ß√µes adicionais" rows="3" />
                    </div>
                  </div>
                )}

                {abaAtiva === 'cursos' && (
                  <div className="space-y-4">
                    <p className="text-gray-600 mb-4">Marque os cursos que o motorista possui e preencha as informa√ß√µes:</p>

                    {Object.entries(listaCursos).map(([key, nome]) => (
                      <div key={key} className="border border-gray-300 rounded-lg p-4 bg-gray-50">
                        <div className="flex items-center mb-3">
                          <input type="checkbox" id={key} checked={formulario.cursos[key]?.possui || false} onChange={(e) => setFormulario({...formulario, cursos: {...formulario.cursos, [key]: { ...formulario.cursos[key], possui: e.target.checked }}})} className="w-5 h-5 text-blue-600 mr-3" />
                          <label htmlFor={key} className="font-semibold text-gray-800 text-lg cursor-pointer">{nome}</label>
                        </div>

                        {formulario.cursos[key]?.possui && (
                          <div className="grid grid-cols-2 gap-3 ml-8">
                            <div>
                              <label className="block text-sm font-semibold text-gray-700 mb-1">N√∫mero do Certificado</label>
                              <input type="text" value={formulario.cursos[key]?.numero || ''} onChange={(e) => setFormulario({...formulario, cursos: {...formulario.cursos, [key]: { ...formulario.cursos[key], numero: e.target.value }}})} className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500" placeholder="Ex: 123456" />
                            </div>
                            <div>
                              <label className="block text-sm font-semibold text-gray-700 mb-1">Data de Validade</label>
                              <input type="date" value={formulario.cursos[key]?.validade || ''} onChange={(e) => setFormulario({...formulario, cursos: {...formulario.cursos, [key]: { ...formulario.cursos[key], validade: e.target.value }}})} className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500" />
                            </div>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                )}

                <div className="flex gap-3 mt-6 pt-6 border-t">
                  <button type="submit" className="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 font-semibold">{editandoId ? 'üíæ Salvar Altera√ß√µes' : '‚ûï Adicionar Motorista'}</button>
                  <button type="button" onClick={() => { setMostrarFormulario(false); setEditandoId(null); setAbaAtiva('dados'); }} className="bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 font-semibold">Cancelar</button>
                </div>
              </form>
            </div>
          )}

          <div className="space-y-4">
            {motoristasFiltrados.length === 0 ? (
              <div className="bg-white rounded-lg shadow-md p-12 text-center">
                <div className="text-6xl mb-4">üìã</div>
                <h3 className="text-xl font-semibold text-gray-700 mb-2">{filtro === 'todos' ? 'Nenhum motorista cadastrado' : 'Nenhum motorista nesta categoria'}</h3>
                <p className="text-gray-500">{filtro === 'todos' ? 'Clique em "Novo Motorista" para adicionar o primeiro registro' : 'Altere o filtro para ver outros motoristas'}</p>
              </div>
            ) : (
              motoristasFiltrados.map(motorista => {
                const statusInfo = getStatusVencimento(motorista.dataVencimento);
                const cursosAtivos = getCursosAtivos(motorista.cursos);

                return (
                  <div key={motorista.id} className={`bg-white rounded-lg shadow-md border-l-4 ${statusInfo.cor} p-6`}>
                    <div className="flex gap-6">
                      <div className="flex-shrink-0">
                        {motorista.fotoUrl ? (
                          <img src={motorista.fotoUrl} alt={motorista.nome} className="w-24 h-24 rounded-lg object-cover border-2 border-gray-300" />
                        ) : (
                          <div className="w-24 h-24 rounded-lg bg-gray-200 flex items-center justify-center text-4xl">üë§</div>
                        )}
                      </div>

                      <div className="flex-grow">
                        <div className="flex justify-between items-start mb-3">
                          <div>
                            <h3 className="text-xl font-bold text-gray-800">{motorista.nome}</h3>
                            <p className="text-gray-600">CNH: {motorista.cnh} | Categoria: {motorista.categoria}</p>
                          </div>
                          <div className="flex gap-2">
                            <button onClick={() => handleEditar(motorista)} className="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 text-sm font-semibold">‚úèÔ∏è Editar</button>
                            <button onClick={() => handleExcluir(motorista.id)} className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 text-sm font-semibold">üóëÔ∏è Excluir</button>
                          </div>
                        </div>

                        <div className="grid grid-cols-3 gap-4 mb-3">
                          <div><span className="text-sm text-gray-600 font-semibold">Emiss√£o:</span><p className="text-gray-800">{motorista.dataEmissao ? new Date(motorista.dataEmissao + 'T00:00:00').toLocaleDateString('pt-BR') : '-'}</p></div>
                          <div><span className="text-sm text-gray-600 font-semibold">Vencimento:</span><p className="text-gray-800">{motorista.dataVencimento ? new Date(motorista.dataVencimento + 'T00:00:00').toLocaleDateString('pt-BR') : '-'}</p></div>
                          <div><span className="text-sm text-gray-600 font-semibold">Status CNH:</span><p className={`font-bold ${statusInfo.status === 'vencida' ? 'text-red-600' : statusInfo.status === 'vence-breve' ? 'text-yellow-600' : statusInfo.status === 'atencao' ? 'text-orange-600' : 'text-green-600'}`}>{statusInfo.icone} {statusInfo.texto}</p></div>
                        </div>

                        {cursosAtivos.length > 0 && (
                          <div className="mt-4 border-t pt-4">
                            <span className="text-sm text-gray-600 font-semibold mb-2 block">üéì Cursos e Certifica√ß√µes:</span>
                            <div className="grid grid-cols-2 gap-2">
                              {cursosAtivos.map(([key, value]) => {
                                const statusCurso = value.validade ? getStatusVencimento(value.validade) : null;
                                return (
                                  <div key={key} className={`p-3 rounded-lg border ${statusCurso ? statusCurso.cor : 'bg-gray-50 border-gray-300'}`}>
                                    <div className="font-semibold text-sm text-gray-800">{listaCursos[key]}</div>
                                    {value.numero && <div className="text-xs text-gray-600">N¬∫ {value.numero}</div>}
                                    {value.validade && (<div className="text-xs font-semibold mt-1">Validade: {new Date(value.validade + 'T00:00:00').toLocaleDateString('pt-BR')} {statusCurso && <span className="ml-2">{statusCurso.icone}</span>}</div>)}
                                  </div>
                                );
                              })}
                            </div>
                          </div>
                        )}

                        {motorista.observacoes && (<div className="mt-3"><span className="text-sm text-gray-600 font-semibold">Observa√ß√µes:</span><p className="text-gray-700">{motorista.observacoes}</p></div>)}
                      </div>
                    </div>
                  </div>
                );
              })
            )}
          </div>
        </div>
      </div>
    );
  }

  ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
